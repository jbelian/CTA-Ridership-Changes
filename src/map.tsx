// map.tsx

import React from "react";
import { MapContainer, TileLayer, GeoJSON } from "react-leaflet";
import { FeatureCollection } from "geojson";
import "leaflet/dist/leaflet.css";
import "./App.css";
import { jawgToken } from "./token.tsx";
import doc from "./data/doc.json";
import { CombinedRoutes } from "./busData.tsx";

function busLinePopup(feature: any, layer: any) {
  layer.bindPopup(`Bus line ${feature.properties.Name}`);
}

const Map = ({
  filteredRoutes,
  keyProp,
}: {
  filteredRoutes: CombinedRoutes[];
  keyProp: string;
}) => {
  const matchingRoutes = doc.features.filter((feature) =>
    filteredRoutes.some((route) => route.route === feature.properties.ROUTE)
  );

  return (
    <MapContainer center={[41.8781, -87.63]} zoom={13}>
      <TileLayer
        attribution='<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        url={`https://{s}.tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token=${jawgToken}`}
      />
      <GeoJSON
        key={keyProp}
        data={
          {
            type: "FeatureCollection",
            features: matchingRoutes,
          } as FeatureCollection
        }
        onEachFeature={busLinePopup}
      />
    </MapContainer>
  );
};

export default Map;

//   // console.log()
//   {
//     const testJsonData = {
//       type: "FeatureCollection",
//       name: "CTA_Routes",
//       crs: {
//         type: "name",
//         properties: { name: "urn:ogc:def:crs:OGC:1.3:CRS84" },
//       },
//       features: [
//         {
//           type: "Feature",
//           properties: {
//             Name: "74",
//             Field_1: "74",
//             NAME2: "FULLERTON",
//             ROUTE: "74",
//             ROUTE0: "074",
//             SAT: 1,
//             "SHAPE.LEN": 46710.841117999997,
//             SUN: 1,
//             WKDAY: 1,
//           },
//           geometry: {
//             type: "MultiLineString",
//             coordinates: [
//               [
//                 [-87.801538048367405, 41.923523440719997],
//                 [-87.8019952543535, 41.923520955690101],
//                 [-87.802004980750098, 41.923647536756199],
//                 [-87.802047142813507, 41.9238729826439],
//                 [-87.802003076239302, 41.924035466919399],
//                 [-87.801778450231694, 41.924048934403402],
//                 [-87.801591623738801, 41.923998396886503],
//                 [-87.801538048367405, 41.923523440719997],
//               ],
//               [
//                 [-87.648765759305903, 41.925457860785599],
//                 [-87.649415759751193, 41.925457861041799],
//                 [-87.649635760876905, 41.925457860356097],
//                 [-87.649945760364901, 41.925457861035497],
//                 [-87.651205760995794, 41.925447859864697],
//                 [-87.652335760249599, 41.925417860780001],
//                 [-87.652715761940001, 41.925407861277201],
//                 [-87.652785760494297, 41.9254078611282],
//                 [-87.652885761706102, 41.925407860474699],
//                 [-87.652925761221098, 41.925407860723503],
//                 [-87.653035761703507, 41.925407860671001],
//                 [-87.653635761811501, 41.925387860378002],
//                 [-87.653995760978006, 41.925387860683898],
//                 [-87.654485761480402, 41.925377860536699],
//                 [-87.654755761125202, 41.925377860225097],
//                 [-87.655625762407794, 41.925357860297403],
//                 [-87.655915762924394, 41.925357860064103],
//                 [-87.656045761868896, 41.925357859869401],
//                 [-87.656405762909998, 41.925347860721899],
//                 [-87.656705762233202, 41.9253378598087],
//                 [-87.657245762592893, 41.925317859797602],
//                 [-87.657855762870298, 41.925307860326797],
//                 [-87.658155762987306, 41.9252978601303],
//                 [-87.658455763011304, 41.9252878600497],
//                 [-87.658835763031405, 41.925277860085203],
//                 [-87.659125762390701, 41.925267860728503],
//                 [-87.660475763835805, 41.925237859463998],
//                 [-87.660935763175104, 41.925237859459997],
//                 [-87.661295763972504, 41.925237859392404],
//                 [-87.661585763981705, 41.925237859238599],
//                 [-87.661935764319196, 41.925237859879999],
//                 [-87.662095764408406, 41.925237859894601],
//                 [-87.662685765048394, 41.925247860117203],
//                 [-87.6633357635707, 41.925247859878503],
//                 [-87.663735764758002, 41.925237859564703],
//                 [-87.664115764085594, 41.9252378592371],
//                 [-87.664505764626796, 41.925227860075701],
//                 [-87.665405765380797, 41.925217859045297],
//                 [-87.665745765749406, 41.925207860113602],
//                 [-87.666195764982902, 41.925197859207998],
//                 [-87.6669557659866, 41.925187859917799],
//                 [-87.667465766391899, 41.925177859213797],
//                 [-87.667735766476298, 41.9251778589894],
//                 [-87.668125765925197, 41.925177859240897],
//                 [-87.6686057658153, 41.925177858843199],
//                 [-87.669335766109995, 41.925167859182402],
//                 [-87.669805766629693, 41.9251578589517],
//                 [-87.670865766308395, 41.925127859049297],
//                 [-87.671415767110204, 41.9251078590814],
//                 [-87.6714957670074, 41.925107859262198],
//                 [-87.671565766127401, 41.925097859356001],
//                 [-87.671655767665996, 41.925097858547097],
//                 [-87.671805767002297, 41.925097858524197],
//                 [-87.671885766881104, 41.925097859333498],
//                 [-87.672215767310007, 41.925107859288801],
//                 [-87.672475767887093, 41.925107859667001],
//                 [-87.673355767981207, 41.925087859446997],
//                 [-87.673825767329902, 41.925077858956897],
//                 [-87.674105767934606, 41.925067858860999],
//                 [-87.6742457679739, 41.925067859463198],
//                 [-87.674845767843706, 41.925057859064701],
//                 [-87.675335767333607, 41.925057859063998],
//                 [-87.675415768390195, 41.925057858320599],
//                 [-87.675855768131299, 41.925057858602699],
//                 [-87.676165768281194, 41.925057858711597],
//                 [-87.676465768004803, 41.925057858395199],
//                 [-87.676905768965796, 41.925057858261603],
//                 [-87.677325769021493, 41.925047859200603],
//                 [-87.677875768641997, 41.925047858917701],
//                 [-87.678625768219106, 41.925037859426901],
//                 [-87.679115768498207, 41.925027858587399],
//                 [-87.680385768884804, 41.925007858811],
//                 [-87.681105769367093, 41.924987858873401],
//                 [-87.681255769033001, 41.924977859093701],
//                 [-87.681365770052693, 41.924977858909898],
//                 [-87.681545770403105, 41.924977858947202],
//                 [-87.681885769517905, 41.924967859022502],
//                 [-87.682375770040395, 41.924987858725103],
//                 [-87.682515769569704, 41.924997859160101],
//                 [-87.682815769947496, 41.925007858477201],
//                 [-87.683175770563906, 41.925017859141597],
//                 [-87.683705770697202, 41.924997859002701],
//                 [-87.684315770421506, 41.924957859332501],
//                 [-87.684695770697701, 41.924947858399499],
//                 [-87.685205771426794, 41.924937859016701],
//                 [-87.685615771605796, 41.924937858729102],
//                 [-87.686885771094495, 41.924927858184802],
//                 [-87.686985771622503, 41.924927858436099],
//                 [-87.6872557719729, 41.924927858223199],
//                 [-87.687645772034102, 41.924917858774798],
//                 [-87.688205771069804, 41.924917858932098],
//                 [-87.688875771630293, 41.924907857966403],
//                 [-87.689085772377197, 41.924897858784497],
//                 [-87.689415771457703, 41.924897858796598],
//                 [-87.690085772446906, 41.924897858893097],
//                 [-87.690145772506199, 41.9248978582809],
//                 [-87.691095772203695, 41.924877858468498],
//                 [-87.691315772741106, 41.924877858037902],
//                 [-87.691485772435797, 41.924877858599302],
//                 [-87.692535773093596, 41.924867857541898],
//                 [-87.692865773249494, 41.924867857547099],
//                 [-87.693755773082302, 41.924857858484799],
//                 [-87.694765773896094, 41.924847858209802],
//                 [-87.694975773939703, 41.924847858172299],
//                 [-87.6951857739882, 41.924847857750699],
//                 [-87.695625773680604, 41.924847857891898],
//                 [-87.696205773642703, 41.924837858061899],
//                 [-87.696885774507606, 41.924837857755897],
//                 [-87.697435774958194, 41.924837858307797],
//                 [-87.697915774178199, 41.924827857788202],
//                 [-87.698625775209507, 41.924817858313403],
//                 [-87.6988957753817, 41.924807857714498],
//                 [-87.699095774911697, 41.924807857907098],
//                 [-87.699875775871902, 41.924807857415601],
//                 [-87.699975775039604, 41.9248078571487],
//                 [-87.700445774463205, 41.924797857516303],
//                 [-87.701425775855, 41.924787857475501],
//                 [-87.701825776019305, 41.924787857707102],
//                 [-87.702295776234607, 41.924777857707902],
//                 [-87.702815775863598, 41.924767857553398],
//                 [-87.703025775683699, 41.924767857195498],
//                 [-87.704605776191698, 41.924747857458001],
//                 [-87.706425777592898, 41.924737857329298],
//                 [-87.7068657766321, 41.924737857605997],
//                 [-87.707235776691604, 41.924727857150003],
//                 [-87.707565777433004, 41.9247278572211],
//                 [-87.708465777238402, 41.924707857119998],
//                 [-87.708505777574402, 41.924707856915603],
//                 [-87.709125777150604, 41.9246978573143],
//                 [-87.709285778271195, 41.924687856369502],
//                 [-87.710455777537703, 41.924697857400602],
//                 [-87.710755778200195, 41.924697857520798],
//                 [-87.711555778775505, 41.924697857303698],
//                 [-87.711735778458902, 41.924697856821801],
//                 [-87.712095779023898, 41.924697856818597],
//                 [-87.712555777904598, 41.924687856138597],
//                 [-87.712755778778799, 41.924677856827898],
//                 [-87.713315778796698, 41.924667856933397],
//                 [-87.7137557789314, 41.924657856896197],
//                 [-87.714535779679494, 41.924647857617799],
//                 [-87.7153257793845, 41.924637856438999],
//                 [-87.715395779597301, 41.924637856839396],
//                 [-87.715775779400005, 41.924637856588902],
//                 [-87.716395779779504, 41.924637856469097],
//                 [-87.716515779464203, 41.924637856521798],
//                 [-87.716945779746794, 41.924627857164303],
//                 [-87.717515780582701, 41.924627857180802],
//                 [-87.718195780337993, 41.924617856673599],
//                 [-87.719425781113202, 41.924567857088597],
//                 [-87.720005780606897, 41.924567856785202],
//                 [-87.7206457815265, 41.9245578567891],
//                 [-87.721865781348399, 41.924557856152603],
//                 [-87.722455782490002, 41.924547857093401],
//                 [-87.722775780946193, 41.924537856540901],
//                 [-87.723065781785806, 41.924537855952302],
//                 [-87.724285782345902, 41.9245278565879],
//                 [-87.7255557824909, 41.924497855880098],
//                 [-87.7263157829981, 41.924497856195501],
//                 [-87.726775782487607, 41.9244978561889],
//                 [-87.727065782594806, 41.924487856269899],
//                 [-87.727285783158095, 41.924487856238102],
//                 [-87.727705783046005, 41.924497855682503],
//                 [-87.7279857826517, 41.924487856512499],
//                 [-87.729215783477798, 41.924467856552901],
//                 [-87.730455785023395, 41.924457855436998],
//                 [-87.731195784418006, 41.924447856154302],
//                 [-87.731675784294296, 41.924447855865097],
//                 [-87.732065784503305, 41.924437855870401],
//                 [-87.732885784466603, 41.924407855779997],
//                 [-87.734105784419299, 41.924387855569499],
//                 [-87.735365785101095, 41.924387855399701],
//                 [-87.735815785693802, 41.924367856176403],
//                 [-87.736035785888504, 41.924367855581799],
//                 [-87.736325786425297, 41.9243578556814],
//                 [-87.736565786051202, 41.924357855415799],
//                 [-87.736735785733202, 41.924357855599197],
//                 [-87.737135786186499, 41.9243478552266],
//                 [-87.737785786228699, 41.924347855744102],
//                 [-87.738995786913904, 41.924327855244201],
//                 [-87.740265787857993, 41.924317854831401],
//                 [-87.741395787043999, 41.924297855159203],
//                 [-87.741585787241902, 41.9242978549306],
//                 [-87.741825787404395, 41.924287855346499],
//                 [-87.742295787057998, 41.924287855476003],
//                 [-87.742635787304295, 41.924287854832698],
//                 [-87.743885787944507, 41.924267855506898],
//                 [-87.744305787918705, 41.9242778545512],
//                 [-87.744695787330301, 41.924277854893298],
//                 [-87.745075787864096, 41.924267854873598],
//                 [-87.745355788670494, 41.924257855659398],
//                 [-87.745415788189902, 41.924257855870799],
//                 [-87.745555787876199, 41.924257855946202],
//                 [-87.746305789138205, 41.924257855516402],
//                 [-87.746665788675699, 41.924247855117699],
//                 [-87.746885788497593, 41.9242478553384],
//                 [-87.746935788899194, 41.924247855004602],
//                 [-87.746975788977807, 41.924247854900699],
//                 [-87.747135789285807, 41.9242478552462],
//                 [-87.747535788865704, 41.9242478546781],
//                 [-87.748785789727407, 41.924227855122702],
//                 [-87.748915789040097, 41.924227855110502],
//                 [-87.750025789397299, 41.924227855138803],
//                 [-87.751235789824307, 41.924217855314403],
//                 [-87.751495790835605, 41.924217855008798],
//                 [-87.753675790367296, 41.924187854417397],
//                 [-87.755635791588304, 41.924137854549201],
//                 [-87.756125791799803, 41.924127854538298],
//                 [-87.756825790980201, 41.9241178545048],
//                 [-87.757335791941301, 41.924117854346001],
//                 [-87.757705792286998, 41.924117854223297],
//                 [-87.758335792641205, 41.924107854180299],
//                 [-87.758595793240204, 41.924107853999899],
//                 [-87.759045792331307, 41.924107853810199],
//                 [-87.759805792666398, 41.924097854782303],
//                 [-87.760325792858694, 41.924087854338403],
//                 [-87.761075792640099, 41.924067853683397],
//                 [-87.761775794070402, 41.924057854091402],
//                 [-87.762295793683705, 41.9240578546598],
//                 [-87.762405793305902, 41.9240578542517],
//                 [-87.762885794031902, 41.9240478539975],
//                 [-87.763445793318596, 41.924037854463698],
//                 [-87.763515792947103, 41.924037854332802],
//                 [-87.763595794071804, 41.924037854267297],
//                 [-87.764375793521907, 41.924027853991802],
//                 [-87.764735793882707, 41.924017854554599],
//                 [-87.765345795287999, 41.924007853859997],
//                 [-87.765385794026301, 41.924007853637796],
//                 [-87.765985794946701, 41.923997854097202],
//                 [-87.766775795062898, 41.9239878536169],
//                 [-87.767065794862006, 41.923987853524402],
//                 [-87.767195794938402, 41.923987853525396],
//                 [-87.768065794870594, 41.923967853200899],
//                 [-87.768415795264701, 41.9239578542172],
//                 [-87.769635795659596, 41.923947853721003],
//                 [-87.769865796014898, 41.923937853563999],
//                 [-87.770845795077605, 41.923917853319701],
//                 [-87.772085796137702, 41.923907852737798],
//                 [-87.773295796671206, 41.923887852666297],
//                 [-87.774485797134602, 41.923867854144703],
//                 [-87.775185796886106, 41.9238578529108],
//                 [-87.775725797010196, 41.923847853820398],
//                 [-87.776385796680401, 41.923827853551998],
//                 [-87.776945798185395, 41.923807853865199],
//                 [-87.777505798163503, 41.923807853315701],
//                 [-87.778165798426699, 41.923817852834503],
//                 [-87.7788257982576, 41.923797852944801],
//                 [-87.779395797816306, 41.923777852675499],
//                 [-87.779645798126396, 41.923777852916899],
//                 [-87.779985799119103, 41.923767853272203],
//                 [-87.780555798547397, 41.923757852683302],
//                 [-87.780625799094494, 41.923757852929],
//                 [-87.781385798866495, 41.9237578524342],
//                 [-87.781625798858201, 41.923757852512502],
//                 [-87.781825799052399, 41.9237578526457],
//                 [-87.782425800064004, 41.923747853619098],
//                 [-87.783025799708497, 41.923737852350598],
//                 [-87.783745799484194, 41.9237378524994],
//                 [-87.784215800293893, 41.923737852991401],
//                 [-87.784775799855495, 41.923717852915203],
//                 [-87.785455799568197, 41.923697852833797],
//                 [-87.785935800229197, 41.923687852543097],
//                 [-87.786235800217696, 41.923687852603102],
//                 [-87.7867857999492, 41.923677852736802],
//                 [-87.787225800841895, 41.923677852064401],
//                 [-87.787355800332406, 41.923677852644303],
//                 [-87.787705801480797, 41.923677852516299],
//                 [-87.788575801296304, 41.923667852563298],
//                 [-87.788765800997595, 41.923667852583698],
//                 [-87.789275801086106, 41.923667852793798],
//                 [-87.789725801458104, 41.923657852065197],
//                 [-87.789975801802896, 41.923647852281398],
//                 [-87.790185801916294, 41.9236478527598],
//                 [-87.790385802194606, 41.9236378523469],
//                 [-87.790655802480302, 41.923637852056402],
//                 [-87.791405802165102, 41.923627852273803],
//                 [-87.7919658019173, 41.923627852320799],
//                 [-87.792395802270406, 41.923627852209798],
//                 [-87.792785801695899, 41.923627852156898],
//                 [-87.793805802521305, 41.923627852415301],
//                 [-87.794015802589499, 41.923627852190599],
//                 [-87.794955802777196, 41.923627852693002],
//                 [-87.795255803740304, 41.923627852597697],
//                 [-87.795735803640397, 41.923617851845997],
//                 [-87.796465803109299, 41.9236078523152],
//                 [-87.797075802683295, 41.9236078523275],
//                 [-87.797665803010503, 41.923607852137799],
//                 [-87.798915804359197, 41.923597851523397],
//                 [-87.799645804649501, 41.923567852400303],
//                 [-87.800725804722205, 41.9235278519836],
//                 [-87.801538048367405, 41.923523440719997],
//               ],
//               [
//                 [-87.648765759305903, 41.925457860785599],
//                 [-87.648295760385196, 41.925117860112998],
//                 [-87.647655759666506, 41.924657860593598],
//                 [-87.647425759165799, 41.924497860624498],
//                 [-87.647335759733195, 41.924427860390303],
//                 [-87.647235760174397, 41.924357860653402],
//                 [-87.647095759199701, 41.924257861223303],
//                 [-87.646885759782805, 41.9241078599674],
//                 [-87.646615759556198, 41.923917860483002],
//                 [-87.646255758927296, 41.923667861078698],
//                 [-87.646205759100496, 41.9236278607423],
//                 [-87.645775759762898, 41.923317860397702],
//                 [-87.644345758048502, 41.922287861222401],
//                 [-87.643805758921303, 41.921887860378298],
//                 [-87.644655757834798, 41.9218878603251],
//                 [-87.644715758626802, 41.921887860046397],
//                 [-87.645355759010101, 41.921887860176099],
//                 [-87.6460757588886, 41.921867860190197],
//                 [-87.646205759154, 41.921867860330998],
//                 [-87.646385759058006, 41.921867860557199],
//                 [-87.647355758950297, 41.921847859692598],
//                 [-87.647535760008296, 41.921847859923297],
//                 [-87.648005758605905, 41.921837860656197],
//                 [-87.648655759293604, 41.921827859746301],
//                 [-87.648675759273502, 41.922267860789702],
//                 [-87.648705759957807, 41.923367860137603],
//                 [-87.648715759454205, 41.9235978597101],
//                 [-87.648715760233699, 41.923617859738101],
//                 [-87.648725760922602, 41.923907860274603],
//                 [-87.648745759802694, 41.924817860712402],
//                 [-87.648755759912603, 41.9251478603192],
//                 [-87.648765759305903, 41.925457860785599],
//               ],
//             ],
//           },
//         },
//       ],
//     };

//     // Extract unique names from filteredRoutes, doc.json and bus.json
//     const matchingRoutesSet = new Set(
//       matchingRoutes.map((feature) => feature.properties.ROUTE)
//     );
//     const filteredRoutesSet = new Set(
//       (filteredRoutes as any[]).map((feature) => feature.route)
//     );
//     const docRoutesSet = new Set(
//       (doc.features as any[]).map((feature) => feature.properties.ROUTE)
//     );
//     const busRoutesSet = new Set((bus as any[]).map((entry) => entry.route));

//     // Find unique entries in filteredRoutes, doc.json and bus.json
//     const uniqueRoutesInFiltered = new Set([...filteredRoutesSet]);
//     const uniqueRoutesInDoc = new Set([...docRoutesSet]);
//     const uniqueRoutesInBus = new Set([...busRoutesSet]);

//     // Find entries only in doc.json and only in bus.json
//     const entriesOnlyInDoc = new Set(
//       [...uniqueRoutesInDoc].filter((name) => !uniqueRoutesInBus.has(name))
//     );
//     const entriesOnlyInBus = new Set(
//       [...uniqueRoutesInBus].filter((route) => !uniqueRoutesInDoc.has(route))
//     );

//     // Log the results
//     console.log("Routes only in doc.json:", [...entriesOnlyInDoc]);
//     console.log("Routes only in bus.json:", [...entriesOnlyInBus]);
//     console.log("Routes in filteredRoutes:", [...uniqueRoutesInFiltered]);
//     console.log("Routes in matchingRoutes:", [...matchingRoutesSet]);
//   }
